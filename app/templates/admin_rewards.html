{% extends "base.html" %}
{% block title %}Admin - Reward Management{% endblock %}

{% block content %}
<style>
    .header {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .table-container {
        margin-top: 20px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    table th, table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    table th {
        background: #34495e;
        color: white;
    }

    table tr:hover {
        background: #ecf0f1;
    }

    .btn {
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
    }

    .reward-btn {
        background-color: #2ecc71;
        color: white;
    }

    .manual-reward {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .manual-reward input[type="number"] {
        width: 60px;
    }

    .alert {
        padding: 10px 15px;
        margin-bottom: 20px;
        border-radius: 5px;
    }

    .alert-success { background-color: #2ecc71; color: white; }
    .alert-danger { background-color: #e74c3c; color: white; }
</style>

<div class="header">
    <h1>üéñ Reward System Management</h1>
</div>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="table-container">
    <h2>üë§ Users (Normal + Company)</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Total Points</th>
                <th>Breakdown (L/M/H/C)</th>
                <th>Badge</th>
                <th>Manual Update</th>
            </tr>
        </thead>
        <tbody>
            {% for user in all_users %}
            <tr>
                <td>{{ user.name }}</td>
                <td>{{ user.role|capitalize }}</td>
                <td><strong>{{ user.token or 0 }}</strong></td>
                <td>{{ user.low }} / {{ user.medium }} / {{ user.high }} / {{ user.critical }}</td>
                <td>
                    {% if user.token >= 26 %}
                        ü•á Gold
                    {% elif user.token >= 11 %}
                        ü•à Silver
                    {% elif user.token > 0 %}
                        ü•â Bronze
                    {% else %}
                        ‚ùå None
                    {% endif %}
                </td>
                <td>
                    <!-- Add Points -->
                    <form method="POST" action="{{ url_for('admin.update_user_token') }}" class="manual-reward" style="margin-bottom: 5px;">
                        <input type="hidden" name="user_id" value="{{ user.id }}">
                        <input type="number" name="token_value" value="10" min="1" required>
                        <input type="hidden" name="token_action" value="add">
                        <button type="submit" class="btn reward-btn">+Reward</button>
                    </form>
                
                    <!-- Reduce Points -->
                    <form method="POST" action="{{ url_for('admin.update_user_token') }}" class="manual-reward">
                        <input type="hidden" name="user_id" value="{{ user.id }}">
                        <input type="number" name="token_value" value="5" min="1" required>
                        <input type="hidden" name="token_action" value="subtract">
                        <button type="submit" class="btn" style="background-color:#e74c3c; color:white;">‚ÄìDeduct</button>
                    </form>
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
